# MusicQuiz

## 概要
MusicQuizは、Discordサーバー上で楽曲クイズを開催できるプログラムです。Botを使用して音声ファイルを送信し、選択肢から曲名を当てる形式のクイズを半自動で進行します。スコア管理や順位発表、ログ出力も自動で行います。

## 主な機能

- **/start**  
  クイズゲームを開始します。サーバー内のメンバー（Bot以外）を自動で参加者として登録します。

- **/next**  
  次の問題を出題します。音声ファイル（mp3）を送信し、選択肢付きの問題文を表示します。選択肢は自動生成または設定ファイルで指定可能です。

- **選択肢ボタンで回答**  
  各ユーザーは表示されたボタンから曲名を選んで回答できます。1ラウンドにつき1回のみ回答可能です。

- **自動タイマー**  
  回答受付は制限時間（デフォルト15秒）で自動的に締め切られます。

- **/score**  
  現在のスコアや最終順位を表示します。順位は自動で計算されます。

- **スコアログ出力**  
  各ラウンド終了時やゲーム終了時に、スコアのログをテキストファイルに出力します。

- **設定ファイル対応**  
  出題曲や選択肢、ラウンド数、制限時間などを`config.ini`で柔軟に設定できます。

## 必要なBot権限

- チャンネルの閲覧（View Channels）
- メッセージの送信（Send Messages）
- メッセージの管理（Manage Messages）※今は不要です。
- メッセージ履歴の閲覧（Read Message History）
- ファイルの添付（Attach Files）
- スラッシュコマンドの利用（Use Slash Commands）
- Permissions Interger = 2147593216（上記の権限をまとめたもの）

## 使い方

### 環境構築・セットアップ手順

1. Python 3.8以降をインストールしてください。
2. 必要なライブラリをインストールします。  
   ```
   pip install -r requirements.txt
   ```
3. `config.ini`を作成し、Botトークンや出題曲情報（データベースパス、ラウンド数など）を設定します。
4. 楽曲データベース（sqlite3形式、例: `songs.db`）を用意し、必要な楽曲情報を登録してください。
5. サーバーにBotを招待し、README記載の権限を付与します。
6. `main.py`を実行します。  
   ```
   python main.py --config configファイルのパス
   ```
7. Discordサーバーで`/start`コマンドを入力してクイズを開始します。

## 注意事項

- 楽曲データベース（sqlite3形式）が必要です。
- Botの起動にはPythonと必要なライブラリ（discord.py等）がインストールされている必要があります。

### 楽曲データベース（songs.db）のテーブル仕様

本プログラムは、楽曲情報をSQLite3データベースから取得します。  
データベースには、最低限以下のような`songs`テーブルが必要です。  
音声ファイルは5sほどに切り取りしているものを使用してください。

#### テーブル例

| カラム名   | 型         | 説明                       |
|:----------|:-----------|:---------------------------|
| id        | INTEGER    | 楽曲ID（主キー, AUTOINCREMENT推奨） |
| title     | TEXT       | 楽曲名                     |
| artist    | TEXT       | アーティスト名              |
| path      | TEXT       | 音声ファイルのフルパス（mp3等） |
